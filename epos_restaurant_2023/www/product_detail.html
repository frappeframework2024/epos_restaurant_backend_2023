{% extends "templates/emenu_layout1.html" %}
{% block style%}
{{doc.css}}
{% endblock %}

{% block page_content %}
<button class="back-btn m-3" id="back-btn" onclick="goBack('{{emenu.route}}')">&#8592; Back to Menu</button>

<div class=" overflow-hidden modal-pp-items section-modal-detail">    
    <div class="modal-img px-3" style="background: #fff;">
        <div class="position-relative">
            <img src="{{doc.photo or "/files/no_image.jpg"}}" alt="" >
            <div class="position-absolute rounded p-1" style="bottom: 10px; background: #db3c76;right: 15px;">
                <p class="text-white">{{doc.product_code}}</p>
            </div>
            {% if doc.is_empty_stock_warning == 1%}
                <div class="position-absolute rounded p-1" style="bottom: 10px; background: #db3c76;left: 15px;">
                    <p class="text-white">* Out of Order</p>
                </div>
            {% endif %}
                  
            {% if doc.discount_value > 0 %}
                <div class="position-absolute rounded p-1" style="top: 5px; background: #db3c76;left: 5px;">
                    {% if (doc.prices|length) > 0 %}
                        {%set _prices = doc.prices |selectattr('price_rule', 'equalto', emenu.default_price_rule) | list  %}
                        {% for price in _prices %}
                            {% if loop.index == 1 %}
                                {% if doc.discount_type == 'Percent' %}
                                    {% set dis_value = doc.discount_value %}
                                    <p class="text-white">{{ dis_value | int }}% Off</p>
                                {% else %}
                                    <p class="text-white">{{ frappe.format(doc.discount_value, {"fieldtype": "Currency"}) }} Off</p>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        {% if doc.discount_type=='Percent' %}
                            {% set dis_value = doc.discount_value %}
                            <p class="text-white">{{ dis_value | int }}% Off</p>
                        {% else %}
                            <p class="text-white">{{ frappe.format(doc.discount_value,{"fieldtype":"Currency"})}} Off</p>
                        {% endif %}
                    {% endif %}
                </div>
            {% endif %} 
        </div>
    </div>
    <div class="p-3">
        <div class="section-top-under-img">
            <div class="">
                <div class="mb-2 wrapper-title-modal text-center">
                    {% if doc.product_name_en == doc.product_name_kh%}
                    <h1 style="font-size: 36px;color:#ff5959">{{doc.product_name_kh}}</h1>
                    {%else%}
                    <h1 style="font-size: 36px;color:#ff5959">{{doc.product_name_kh}}</h1>
                    <h1>{{doc.product_name_en}}</h1>
                    {%endif%}
                </div>
                <div class="modal-pirc text-center">      
                            {% if (doc.prices|length) > 0 %}
                            {%set _prices = doc.prices |selectattr('price_rule', 'equalto', emenu.default_price_rule) | list  %}
                                {% for price in _prices %}    
                                    {% if doc.discount_value > 0 %}
                                    {%if price.portion != "Normal" %} <div><span class="price-cus portion">{{price.portion}}</span></div> {%endif%}
                                        <div class="d-flex gap-2 justify-center price-portion">    
                                            <del class="price-cus" style="color:#ccc">{{frappe.format(price.price or 0,{"fieldtype":"Currency"})}}</del>
                                            {% if doc.discount_type=='Percent' %}
                                                <p class="price-cus">{{frappe.format((price.price or 0) - ((price.price or 0)* (doc.discount_value/100) ),{"fieldtype":"Currency"})}}</p>
                                            {% else %}
                                                <p class="price-cus">{{frappe.format((price.price or 0) - (doc.discount_value) ,{"fieldtype":"Currency"})}}</p>
                                            {%endif%}
                                        </div>
                                    {% else %}
                                        <p class="price-cus portion">
                                            {%if price.portion != "Normal" %} <span>{{price.portion}}:</span> {%endif%}
                                            {{frappe.format(price.price or 0,{"fieldtype":"Currency"})}}
                                        </p>
                                    {% endif %}   
                                {% endfor %}
                            {% else %}
                                <div class="flex gap-2 justify-center"> 
                                    {% if doc.discount_value > 0 %}
                                        <del class="price-cus" style="color: #ccc;">{{frappe.format(doc.price,{"fieldtype":"Currency"})}}</del>
                                        {% if doc.discount_type=='Percent' %}
                                            <p class="price-cus">{{frappe.format((doc.price or  0) - ((doc.price or 0)* (doc.discount_value/100) ),{"fieldtype":"Currency"})}}</p>
                                        {%else%}
                                            <p class="price-cus">{{frappe.format((doc.price or 0) - (doc.discount_value) ,{"fieldtype":"Currency"})}}</p>
                                        {%endif%}
                                    {% else %}
                                        <p class="price-cus">{{frappe.format(doc.price,{"fieldtype":"Currency"})}}</p>
                                    {% endif %}
                                </div>
                            {% endif %} 
                </div>
            </div>
            <br/>
            <h2 class="text-center">Order Now</h2>
            {% if emenu.hotel_room_call_number %}
                <h4 style="color:#ff5959" class="text-center">From Hotel Room: Please Deal {{emenu.hotel_room_call_number}}</h4>
            {% endif %}
            {% if emenu.phone_number %}
                <h4 style="color:#ff5959" class="text-center">From Outside: {{emenu.phone_number}}</h4>
            {% endif %}
            {% if emenu.address %}
            <div style="font-weight: 500;" class="text-center">{{emenu.address}} </div>
            {% endif %}
        </div>
    </div>
</div>
<!-- <button id="btn_add_to_order" data-id="{{doc.product_code}}">Add to order</button>
<button id="submit_order" >Submit Order</button> -->
{% endblock %}