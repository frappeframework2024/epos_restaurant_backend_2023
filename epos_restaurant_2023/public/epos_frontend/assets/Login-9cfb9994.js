import{_ as ee,i as w,a as se,u as te,b as oe,c as ne,r as B,d as le,e as $,o as ae,f as v,g as V,w as n,h as m,j as t,k as o,l as s,t as u,n as ie,m as re,p as r,q as y,s as de,F as ce,v as ue,x as D,y as _e,z as pe,A as I,B as me}from"./index-52886ac5.js";const ge=h=>(_e("data-v-daa61489"),h=h(),pe(),h),fe={class:"h-full w-full p-10 flex justify-center items-center position-relative"},ve=ge(()=>o("div",{class:"position-absolute",style:{top:"50px"}},null,-1)),be={class:"app-info w-96 inline-block text-center rounded-lg pa-4 bg-gradient-to-t from-yellow-900 to-yellow-700 text-white shadow-sm"},we={class:"mb-3"},he=["src"],xe={class:"font-bold mb-3"},ke={class:"py-3"},ye={class:"h-full flex items-center justify-center bg-gray-100"},Ce=["onSubmit"],Se={class:"w-73"},$e={class:"d-block d-md-none mt-4"},Ie={class:"mb-3"},Le=["src"],ze={class:"text-center mb-3"},Ne={class:"font-bold mb-1 text-2xl"},Pe={class:"text-sm"},Ee={class:"mb-3"},Be={class:"relative"},Ve={class:"grid grid-cols-3 gap-3"},De={class:"mt-4"},Oe={key:0,class:"mt-2"},je={key:1,class:"mt-2"},Ae={class:"mt-4 text-center"},Je={class:"text-sm text-green-700"},Me={class:"text-sm text-red-700"},Fe={key:0,class:"fixed bottom-8"},Re={__name:"Login",setup(h){const O=w("$frappe").db(),{t:_}=se.global,j=w("$auth"),f=w("$pos_license"),L=w("$gv"),A=w("$sale"),{mobile:J}=te(),C=me({position:"top"}),M=oe(),g=ne(),x=B(),k=B("");g.state.isLoading=!1;let i=le({username:"",password:""});const c=$(()=>JSON.parse(localStorage.getItem("setting"))),F=$(()=>g.state.isLoading),R=$(()=>localStorage.getItem("device_name"));ae(()=>{localStorage.removeItem("current_user"),localStorage.removeItem("make_order_auth"),O.getDocList("POS Translation",{fields:["name","language_name","flag"]}).then(l=>{x.value=l}),k.value=localStorage.getItem("__language_name")});function z(l,e){localStorage.setItem("__language_name",e),localStorage.setItem("lang",l),k.value!=e&&location.reload()}function p(l){i.password==null&&(i.password=""),i.password=i.password+l}function T(){i.password=""}function U(){return localStorage.getItem("is_window")=="1"}function W(){i.password=i.password.substring(0,i.password.length-1)}const q=async()=>{if(f.web_platform&&(!f.license.status||(f.license?.expired??!1)))return;if(!i.password){C.warning(_("msg.Invalid PIN Code"),{position:"top"});return}g.dispatch("startLoading");let l=!1;I({url:"epos_restaurant_2023.api.api.check_username",auto:!0,params:{pin_code:i.password},async onSuccess(e){g.dispatch("startLoading"),i.username=e.username,i.username&&i.password&&(await j.login(i.username,i.password)?(H(e),G()):(C.warning("msg.Login fail Invalid username or password"),g.dispatch("endLoading")))},onError(e){l||(l=!0,g.dispatch("endLoading"),C.warning(_("msg.Invalid PIN Code"),{position:"top"}))}})};function H(l){I({url:"epos_restaurant_2023.api.api.get_user_information",auto:!0,async onSuccess(e){e.permission=l.permission,localStorage.setItem("current_user",JSON.stringify(e)),M.push({name:"Home"}),g.dispatch("endLoading")},onError(e){g.dispatch("endLoading")}})}function G(){I({url:"epos_restaurant_2023.api.promotion.check_promotion",cache:"check_promotion",auto:!0,params:{business_branch:L.setting.business_branch},onSuccess(l){L.promotion=l,A.promotion=l}})}function K(){const l={action:"exit"};window.chrome.webview.postMessage(JSON.stringify(l))}return(l,e)=>{const S=m("v-divider"),b=m("v-list-item"),N=m("v-list"),P=m("v-col"),Q=m("v-text-field"),d=m("v-btn"),X=m("v-list-item-title"),Y=m("v-menu"),Z=m("v-row");return v(),V(Z,{class:"mt-0 mb-0 h-screen"},{default:n(()=>[t(P,{md:"6",lg:"8",class:"pa-0 d-sm-none d-none d-md-block"},{default:n(()=>[o("div",{class:"h-screen bg-cover bg-no-repeat bg-center",style:ie({"background-image":"url("+s(c)?.login_background+")"})},[o("div",fe,[ve,o("div",null,[o("div",be,[o("div",we,[o("img",{class:"my-0 mx-auto",src:s(c)?.logo,style:{"max-height":"150px"}},null,8,he)]),o("h1",xe,u(s(c)?.app_name),1),t(S),o("div",ke,[t(N,{lines:"one","bg-color":"transparent"},{default:n(()=>[t(b,{class:"mb-2",title:s(c)?.business_branch,subtitle:s(_)("Business")},null,8,["title","subtitle"]),t(b,{class:"mb-2",title:s(c)?.pos_profile,subtitle:s(_)("POS Profile")},null,8,["title","subtitle"]),t(b,{class:"mb-2",title:s(c)?.phone_number,subtitle:s(_)("Phone Number")},null,8,["title","subtitle"]),t(b,{title:s(c)?.address,subtitle:s(_)("Address")},null,8,["title","subtitle"])]),_:1})])])])])],4)]),_:1}),t(P,{sm:"12",md:"6",lg:"4",class:"pa-0 relative"},{default:n(()=>[o("div",ye,[o("form",{onSubmit:re(q,["prevent"])},[o("div",Se,[o("div",null,[o("div",$e,[o("div",Ie,[o("img",{class:"my-0 mx-auto w-16",src:s(c)?.logo},null,8,Le)]),o("div",ze,[o("h1",Ne,u(s(c)?.app_name),1),o("p",Pe,u(s(c)?.business_branch),1),t(S)])]),o("div",Ee,[o("div",Be,[t(Q,{readonly:s(J),type:"password",density:"compact",variant:"solo",autofocus:"",label:s(_)("Password"),"append-inner-icon":"mdi-arrow-left","single-line":"","hide-details":"",modelValue:s(i).password,"onUpdate:modelValue":e[0]||(e[0]=a=>s(i).password=a),height:"200","onClick:appendInner":e[1]||(e[1]=a=>W())},null,8,["readonly","label","modelValue"])])]),o("div",null,[o("div",Ve,[t(d,{onClick:e[2]||(e[2]=a=>p("1")),size:"x-large"},{default:n(()=>[r(" 1 ")]),_:1}),t(d,{onClick:e[3]||(e[3]=a=>p("2")),size:"x-large"},{default:n(()=>[r(" 2 ")]),_:1}),t(d,{onClick:e[4]||(e[4]=a=>p("3")),size:"x-large"},{default:n(()=>[r(" 3 ")]),_:1}),t(d,{onClick:e[5]||(e[5]=a=>p("4")),size:"x-large"},{default:n(()=>[r(" 4 ")]),_:1}),t(d,{onClick:e[6]||(e[6]=a=>p("5")),size:"x-large"},{default:n(()=>[r(" 5 ")]),_:1}),t(d,{onClick:e[7]||(e[7]=a=>p("6")),size:"x-large"},{default:n(()=>[r(" 6 ")]),_:1}),t(d,{onClick:e[8]||(e[8]=a=>p("7")),size:"x-large"},{default:n(()=>[r(" 7 ")]),_:1}),t(d,{onClick:e[9]||(e[9]=a=>p("8")),size:"x-large"},{default:n(()=>[r(" 8 ")]),_:1}),t(d,{onClick:e[10]||(e[10]=a=>p("9")),size:"x-large"},{default:n(()=>[r(" 9 ")]),_:1}),t(d,{onClick:e[11]||(e[11]=a=>p("0")),size:"x-large"},{default:n(()=>[r(" 0 ")]),_:1}),t(d,{class:"col-span-2",color:"error",onClick:T,size:"x-large"},{default:n(()=>[r(u(s(_)("Clear")),1)]),_:1})])]),o("div",De,[t(d,{type:"submit",loading:s(F),size:"x-large",class:"w-full",color:"primary",disabled:s(f).web_platform&&(!(s(f).license?.status??!1)||(s(f).license?.expired??!1))},{default:n(()=>[r(u(s(_)("Login")),1)]),_:1},8,["loading","disabled"])]),s(x)?.length<=2?(v(),y("div",Oe,[t(d,{size:"x-large",class:"w-full",color:"light",onClick:e[12]||(e[12]=()=>{l.$i18n.locale=l.$i18n.locale=="kh"?"en":"km",z(l.$i18n.locale)})},{default:n(()=>[r(u(l.$i18n.locale=="en"?"ខ្មែរ":"English"),1)]),_:1})])):s(x)?.length>=3?(v(),y("div",je,[t(Y,null,{activator:n(({props:a})=>[t(d,de({size:"x-large",class:"w-full",color:"light"},a),{default:n(()=>[r(u(s(k)==null?(l.$i18n.locale=="en","English"):s(k)),1)]),_:2},1040)]),default:n(()=>[t(N,null,{default:n(()=>[(v(!0),y(ce,null,ue(s(x),(a,E)=>(v(),V(b,{onClick:Ue=>z(a.name,a.language_name),key:E,value:E},{default:n(()=>[t(X,null,{default:n(()=>[r(u(a.language_name),1)]),_:2},1024)]),_:2},1032,["onClick","value"]))),128))]),_:1})]),_:1})])):D("",!0),o("div",Ae,[o("p",Je,u(s(c)?.pos_profile),1),o("p",Me,u(s(R)),1)])])])],40,Ce),U()?(v(),y("div",Fe,[t(d,{block:"",class:"w-full","prepend-icon":"mdi-window-close",size:"x-large",color:"error",onClick:e[13]||(e[13]=a=>K())},{default:n(()=>[r(u(s(_)("Exit")),1)]),_:1})])):D("",!0)])]),_:1})]),_:1})}}},qe=ee(Re,[["__scopeId","data-v-daa61489"]]);export{qe as default};
